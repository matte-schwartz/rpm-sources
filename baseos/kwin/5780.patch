From 5e122cb6c0e4b2573ac568b040b9a9187e8d8313 Mon Sep 17 00:00:00 2001
From: Xaver Hugl <xaver.hugl@gmail.com>
Date: Mon, 27 May 2024 15:14:27 +0200
Subject: [PATCH] wayland/linuxdrmsyncobjv1: don't emit a protocol error for
 unmapping a surface

---
 src/wayland/linux_drm_syncobj_v1.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/wayland/linux_drm_syncobj_v1.cpp b/src/wayland/linux_drm_syncobj_v1.cpp
index b77b0b84d6a..091e241301b 100644
--- a/src/wayland/linux_drm_syncobj_v1.cpp
+++ b/src/wayland/linux_drm_syncobj_v1.cpp
@@ -157,7 +157,7 @@ void LinuxDrmSyncObjSurfaceV1::wp_linux_drm_syncobj_surface_v1_destroy(Resource
 bool LinuxDrmSyncObjSurfaceV1::maybeEmitProtocolErrors()
 {
     const auto priv = SurfaceInterfacePrivate::get(m_surface);
-    if (!priv->pending->bufferIsSet && !priv->pending->acquirePoint.timeline && !priv->pending->releasePoint) {
+    if ((!priv->pending->bufferIsSet || !priv->pending->buffer) && !priv->pending->acquirePoint.timeline && !priv->pending->releasePoint) {
         return false;
     }
     if (!priv->pending->acquirePoint.timeline) {
-- 
GitLab

